[
  // --- Global / Workspace Bindings ---
  {
    "context": "Workspace",
    "bindings": {
      "cmd-p": "file_finder::Toggle",
      "alt-h": "workspace::ActivatePaneLeft",
      "alt-l": "workspace::ActivatePaneRight",
      "alt-k": "workspace::ActivatePaneUp",
      "alt-j": "workspace::ActivatePaneDown",
      "alt-shift-s": "workspace::SaveAs",
      "ctrl-cmd-4": "workspace::ToggleRightDock",
      "cmd-_": "workspace::ToggleRightDock",
      "cmd-shift-s": null,
      "alt-cmd-b": null,
      "cmd-m": null
    }
  },
  {
    "context": "Workspace && mode == full",
    "bindings": {
      "space g g": ["task::Spawn", { "task": "Open lazygit" }]
    }
  },

  // --- Pane & Navigation ---
  {
    "context": "Pane",
    "bindings": {
      "ctrl-tab": "pane::ActivateNextItem",
      "ctrl-shift-tab": "pane::ActivatePreviousItem"
    }
  },

  // --- General Editor Bindings ---
  {
    "context": "Editor",
    "bindings": {
      "cmd-a": "agent::ToggleFocus",
      "cmd-s": "workspace::Save",
      "cmd-g": "git_panel::ToggleFocus",
      "cmd-shift-s": "git::StageRange",
      "ctrl-n": "search::SelectNextMatch",
      "ctrl-d": "search::SelectNextMatch",
      "alt-n": "git::StageAndNext"
    }
  },
  {
    "context": "Editor && mode == full",
    "bindings": {
      "cmd-o": "outline::Toggle",
      "cmd-p": "file_finder::Toggle",
      "cmd-shift-g": "go_to_line::Toggle",
      "ctrl-g": "go_to_line::Toggle",
      // "cmd-a": "pane::ActivatePreviousItem",
      // "cmd-d": "pane::ActivateNextItem",
      "cmd-e": null,
      "cmd-h": ["buffer_search::Deploy", { "focus": false }],
      "cmd-shift-e": ["buffer_search::Deploy", { "focus": false }]
    }
  },

  // --- Vim: Global / Shared Modes ---
  {
    "context": "vim_mode == normal || vim_mode == visual",
    "bindings": {
      "s": "vim::PushSneak",
      "shift-s": "vim::PushSneakBackward"
    }
  },

  // --- Vim: Normal Mode ---
  {
    "context": "Editor && vim_mode == normal && !VimWaiting && !menu",
    "bindings": {
      // Navigation & Movement
      "down": "editor::MoveLineDown",
      "up": "editor::MoveLineUp",
      "ctrl-e": ["workspace::SendKeystrokes", "ctrl-e ctrl-e ctrl-e ctrl-e ctrl-e ctrl-e ctrl-e"],
      "ctrl-y": ["workspace::SendKeystrokes", "ctrl-y ctrl-y ctrl-y ctrl-y ctrl-y ctrl-y ctrl-y"],

      // Git Operations
      "_": "git::ToggleStaged",
      "cmd-shift-s": "git::ToggleStaged",
      "-": "editor::ToggleSelectedDiffHunks",
      "space f": "editor::ToggleSelectedDiffHunks",

      // LSP / Coding
      "g i": "editor::FindAllReferences",
      "g a": "editor::ToggleCodeActions",
      "g r": "editor::Rename",
      "space w": "workspace::Save"
    }
  },

  // --- Vim: Visual Mode ---
  {
    "context": "Editor && vim_mode == visual && !VimWaiting && !menu",
    "bindings": {
      "down": "editor::MoveLineDown",
      "up": "editor::MoveLineUp",
      "space u": "git::UnstageAndNext"
    }
  },

  // --- Vim: Insert Mode ---
  {
    "context": "Editor && vim_mode == insert && !menu",
    "bindings": {
      "k j": "vim::NormalBefore",
      "kj": "vim::NormalBefore"
    }
  },

  // --- Other Panels & Overrides ---
  {
    "context": "VimControl && !menu",
    "bindings": {
      "tab": "vim::Matching"
    }
  },
  {
    "context": "EditorParent",
    "bindings": {
      "cmd-r": "agent::ToggleFocus"
    }
  },
  {
    "bindings": {
      "ctrl-p": ["task::Spawn", { "task_name": "Television File Finder", "reveal_target": "center" }],
      "cmd-.": "terminal_panel::ToggleFocus",
      "cmd->": "workspace::NewCenterTerminal",
      "cmd-h": "workspace::ActivatePaneLeft",
      "cmd-;": "workspace::ToggleRightDock",
      "cmd-j": "tab_switcher::ToggleAll",
      "cmd-l": "tab_switcher::Toggle",
      "cmd-e": "project_panel::ToggleFocus",
      "alt-cmd-h": null
    }
  },
  {
    "context": "RulesLibrary",
    "bindings": {
      "cmd-shift-s": null
    }
  },
  {
    "context": "(MessageEditor && !Picker) > (Editor && !use_modifier_to_send)",
    "bindings": {
      "cmd-enter": null
    }
  }
]
